[tools]
go = "1.23"
node = "22"
bun = "1"

[tasks.dev-frontend]
description = "Start Vite dev server with HMR"
dir = "web"
run = "bun run dev"

[tasks.dev-backend]
description = "Start Go backend in dev mode"
run = "go run ./cmd/peel --dev --port 8080 --no-open"

[tasks.build]
description = "Build single binary with embedded frontend"
run = """
cd web && bun run build && cd .. && rm -rf internal/embed/dist && cp -r web/dist internal/embed/dist && go build -o peel ./cmd/peel
"""

[tasks.clean]
description = "Remove build artifacts"
run = """
rm -f peel
rm -rf web/dist internal/embed/dist
mkdir -p internal/embed/dist
echo '<!DOCTYPE html><html><body><p>peel â€” run mise run build</p></body></html>' > internal/embed/dist/index.html
"""
